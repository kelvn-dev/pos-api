# ModSecurity Core Rule Set Configuration
SecRuleEngine On

# Debug Log Configuration
SecDebugLog /var/log/modsecurity/debug.log
SecDebugLogLevel 3

# Audit Log Configuration
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsecurity/audit.log
SecAuditLogFormat JSON
SecAuditLogParts ABCDEFHIJKZ
SecAuditLogType Serial

# Basic ModSecurity Settings
SecResponseBodyAccess Off
SecRule REQUEST_HEADERS:User-Agent "ModSecurity" "id:999999,deny,status:403"
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyInMemoryLimit 131072
SecPcreMatchLimit 100000
SecPcreMatchLimitRecursion 100000

# Enable OWASP CRS
Include /usr/local/owasp-modsecurity-crs/crs-setup.conf
Include /usr/local/owasp-modsecurity-crs/rules/*.conf

# ðŸš€ **Custom SQL Injection Rules**
# Blocks SQL injection attempts by detecting common attack patterns

SecRule REQUEST_URI|REQUEST_HEADERS|REQUEST_BODY "(?i)(union.*select.*from|select.*from.*where|insert.*into.*values|update.*set.*where|delete.*from.*where)" \
    "id:1001,phase:2,deny,status:403,msg:'SQL Injection Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(\b(select|union|insert|update|delete|drop|exec|fetch|declare|cast|convert|or|and)\b.*(\bfrom|into|set|where|values|database|table)\b)" \
    "id:1002,phase:2,deny,status:403,msg:'SQL Injection Attempt Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)('\s*(or|and)\s*[0-9]+=+[0-9]+)" \
    "id:1003,phase:2,deny,status:403,msg:'SQL Injection Boolean-Based Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(union\s*select\s*(\d+|null),(\d+|null),(\d+|null),(\d+|null),(\d+|null),(\d+|null),(\d+|null))" \
    "id:1004,phase:2,deny,status:403,msg:'SQL Injection UNION-Based Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)('\s*or\s*'.+?'\s*=\s*'.+?')" \
    "id:1005,phase:2,deny,status:403,msg:'SQL Injection String-Based Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)('\s*or\s*\d+\s*=\s*\d+)" \
    "id:1006,phase:2,deny,status:403,msg:'SQL Injection Numeric-Based Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(benchmark\s*\(\s*\d+\s*,\s*md5\s*\(\s*'.*?'\s*\)\s*\))" \
    "id:1007,phase:2,deny,status:403,msg:'SQL Injection Time-Based Attack Detected'"

SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)('\s*;\s*(exec|select|update|delete|insert|drop|create|alter)\s*.+?\s*')" \
    "id:1008,phase:2,deny,status:403,msg:'SQL Injection Attempt with Semicolon Detected'"

# ðŸš€ **Block Common SQLi Payloads**
SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)('\s*(;|--|#|\b(OR|AND)\b\s*\d+=\d+))" \
    "id:1009,phase:2,deny,status:403,msg:'SQL Injection Comment Attack Detected'"

# ðŸš€ **Prevent MySQL/Sleep Attacks**
SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(sleep\s*\(\s*\d+\s*\))" \
    "id:1010,phase:2,deny,status:403,msg:'SQL Injection Time Delay Attack Detected'"

# ðŸš€ **Deny Access to mysql.user Table**
SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(select\s+\*\s+from\s+mysql\.user)" \
    "id:1011,phase:2,deny,status:403,msg:'Unauthorized Access Attempt to MySQL User Table'"

# ðŸš€ **Block Encoded SQLi Attacks**
SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(%27|%22|%3D|%3B|%23|%2D%2D|%2F%2A|\b(select|union|insert|update|delete|drop|exec|fetch|declare|cast|convert)\b)" \
    "id:1012,phase:2,deny,status:403,msg:'SQL Injection Encoded Attack Detected'"

# ðŸš€ **Block SQL Wildcard Operators**
SecRule REQUEST_URI|ARGS|REQUEST_BODY "(?i)(\b(select|union|insert|update|delete|drop|exec|fetch|declare|cast|convert)\b.*(\b%\b|\b_\b|\b\[\b))" \
    "id:1013,phase:2,deny,status:403,msg:'SQL Injection Wildcard Attack Detected'"

# ðŸš€ **Block SQL Injection in Cookies**
SecRule REQUEST_COOKIES "(?i)(select.*from|union.*select|insert.*into|update.*set|delete.*from)" \
    "id:1014,phase:2,deny,status:403,msg:'SQL Injection Attempt in Cookies'"

# ðŸš€ **Block SQL Injection in HTTP Headers**
SecRule REQUEST_HEADERS "(?i)(select.*from|union.*select|insert.*into|update.*set|delete.*from)" \
    "id:1015,phase:2,deny,status:403,msg:'SQL Injection Attempt in Headers'"

# ðŸš€ **Block SQL Injection in User-Agent**
SecRule REQUEST_HEADERS:User-Agent "(?i)(select.*from|union.*select|insert.*into|update.*set|delete.*from)" \
    "id:1016,phase:2,deny,status:403,msg:'SQL Injection Attempt in User-Agent'"

